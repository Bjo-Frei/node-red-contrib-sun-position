<!DOCTYPE HTML>

<script type="text/javascript">
    /**
     * save rules
     * @param {number} rules - output of the editableList
     * @returns {number} number of decimals
     */
    function saveRules(rules) {
        const result = [];
        if (rules) {
            rules.each(function (_i) {
                const rule = $(this);
                const data = {
                    index: _i,
                    timeValue: rule.find('.node-input-rule-time').typedInput('value'),
                    timeType: rule.find('.node-input-rule-time').typedInput('type'),
                    timeOp: rule.find('.node-input-rule-time-operator').val(),
                    timeOpText: rule.find('.node-input-rule-time-operator option:selected').text(),
                    outputValue: rule.find('.node-input-rule-output').typedInput('value'),
                    outputType: rule.find('.node-input-rule-output').typedInput('type'),
                    offsetValue: rule.find('.node-input-rule-offset').typedInput('value'),
                    offsetType: rule.find('.node-input-rule-offset').typedInput('type'),
                    multiplier: rule.find('.node-input-rule-multiplier').val(),
                    validOperandAValue: rule.find('.node-input-rule-condOpA').typedInput('value'),
                    validOperandAType: rule.find('.node-input-rule-condOpA').typedInput('type'),
                    validOperator: rule.find('.node-input-rule-condOperator').val(),
                    validOperatorText: rule.find('.node-input-rule-condOperator option:selected').text(),
                    validOperandBValue: rule.find('.node-input-rule-condOpB').typedInput('value'),
                    validOperandBType: rule.find('.node-input-rule-condOpB').typedInput('type')
                };
                result.push(data);
            });
        }
        return result;
    }
    /**
     * resizes a rule
     * @param {jQuery} rule - the jQuery selector of the rule
     */
    function resizeRule(rule) {
        try {
            const newWidth = rule.width() - 10;
            // row1
            const $validOperandALbl = rule.find('.node-input-rule-condOpA-lbl');
            const $validOperandA = rule.find('.node-input-rule-condOpA');
            const $validOperator = rule.find('.node-input-rule-condOperator');
            $validOperandALbl.width('auto');
            if ($validOperator.is(':visible')) {
                $validOperator.width(100);
                $validOperandA.typedInput('width', (newWidth - $validOperandALbl.width() - 135));
            } else {
                $validOperandA.typedInput('width', (newWidth - $validOperandALbl.width() - 15));
            }
            // row2
            const $validOperandBLbl = rule.find('.node-input-rule-condOpB-lbl');
            const $validOperandB = rule.find('.node-input-rule-condOpB');
            $validOperandBLbl.width('auto');
            $validOperandB.typedInput('width', (newWidth - $validOperandBLbl.width() - 10));
            // row3
            const $timeLbl = rule.find('.node-input-rule-time-lbl');
            const $timeOperator = rule.find('.node-input-rule-time-operator');
            const $time = rule.find('.node-input-rule-time');
            $timeLbl.width('auto');
            if ($timeOperator.is(':visible')) {
                $timeOperator.width(70);
                $time.typedInput('width', (newWidth - $timeLbl.width() - 103));
            } else {
                $time.typedInput('width', (newWidth - $timeLbl.width() - 33));
            }
            // row4
            const $offset = rule.find('.node-input-rule-offset');
            const $multiplier = rule.find('.node-input-rule-multiplier');
            const multiplierWidth = 125;
            $multiplier.width(multiplierWidth);
            $offset.typedInput('width', (newWidth - multiplierWidth - 50));
            // row5
            const $outputLbl = rule.find('.node-input-rule-output-lbl');
            const $output = rule.find('.node-input-rule-output');
            $outputLbl.width('auto');
            $output.typedInput('width', (newWidth - $outputLbl.width() - 30));
        } catch (ex) {
            console.log(ex); // eslint-disable-line
        }
    }

    RED.nodes.registerType('time-control', {
        category: 'advanced-input',
        color: '#FFCC66',
        icon: 'blind-white.png',
        inputs: 1,
        outputs: 1,
        defaults: {
            name: {
                value: '',
                required: false
            },
            topic: {
                value: '',
                required: false
            },
            positionConfig: {
                value: '',
                type: 'position-config',
                required: true
            },
            outputs: { value: '1' },

            outputDefault: {
                value: '',
                validate: RED.validators.typedInput('outputDefault')
            },
            outputDefaultType: {
                value: 'str'
            },
            // #region overwrite settings
            overwriteExpire: {
                value: '',
                required: false,
                validate(v) {
                    const n = parseFloat(v);
                    return (v === '') || (RED.validators.number(v) && (n >= 200) && (n < 0x7FFFFFFF));
                }
            },
            // #endregion overwrite settings
            // #region rule settings
            rules: {
                value: {}
            }
            // #endregion time settings
        },
        outputLabels() {
            return [this._('time-control.label.output1'), this._('time-control.label.output2')];
        },
        label() {
            let suffix = '';
            if (this.rules && (this.rules.length >0)) {
                suffix += '‚è≤';
            }
            if (this.name) {
                return this.name+' '+suffix;
            }
            const result = this._('time-control.label.time-control');
            if (this.topic && (this.topic.length + result.length <= 32)) {
                return this.topic + ':' + result+' '+suffix;
            }
            return result+' '+suffix;
        },
        labelStyle() {
            return this.name ? 'node_label_italic' : '';
        },
        paletteLabel() { return this._('time-control.label.time-control-palette'); },
        oneditprepare() {
            setTimeout(() => {
                $('.is-to-show-initially').show();
                $('.is-to-hide-initially').hide();
            }, 300);
            $('.rdg-ui-btn').button();

            this.outputs = this.outputs || 1;
            const $nodeConfig = $('#node-input-positionConfig');
            const node = this;

            const setup = function(node) {
                /* global getTypes getSelectFields setupTInput appendOptions addLabel getBackendData */
                // #region initialize
                const types = getTypes(node);
                const selFields = getSelectFields();

                /**
                 * save rules
                 * @param {*} node - the node representation
                 * @param {string} name - the node representation
                 * @param {*} element - the node representation
                 * @param {number} rules - output of the editableList
                 * @returns {number} number of decimals
                */
                function setMultiplier(node, name, element, validate, defMultiplier) {
                    const c = Number(node[name]);
                    if (node[name] !== '' && !isNaN(c)) {
                        let r = 1000;
                        if (c % 3600000 === 0) {
                            r = 3600000;
                        } else if (c % 60000 === 0) {
                            r = 60000;
                        }
                        $('#time-control-' + name).val(c/r);
                        $('#time-control-' + name + '-multiplier').val(r);
                    } else {
                        $('#time-control-' + name).val('');
                        $('#time-control-' + name + '-multiplier').val(defMultiplier || 1000);
                    }
                    $('#time-control-' + name).on('change focus focusout', () => {
                        const el = $('#time-control-' + name);
                        let val = el.val();
                        const mp = $('#time-control-' + name + '-multiplier').val();
                        if (isNaN(val) || val === '' || val === 0) {
                            val = '';
                            $('node-input-' + name).val('');
                        } else {
                            val = val * mp;
                            $('#node-input-' + name).val(val);
                        }

                        if (typeof validate === 'function') {
                            if (validate(val)) {
                                el.removeClass( 'input-error' );
                            } else {
                                el.addClass( 'input-error' );
                            }
                        }
                    });

                    $('#time-control-' + name + '-multiplier').change( () => {
                        $('#time-control-' + name).change();
                    });
                    $('#time-control-' + name).change();
                }

                // #endregion initialize
                // #region default
                setMultiplier(node,'overwriteExpire', v => {
                    const n = parseFloat(v);
                    return (v === '') || (RED.validators.number(v) && (n >= 200) && (n < 0x7FFFFFFF));
                }, 3600000);
                setupTInput(node, {
                    typeProp: 'outputDefaultType',
                    valueProp: 'outputDefault',
                    width: 'calc(100% - 110px)',
                    defaultType: 'str',
                    defaultValue: 'default',
                    types: [
                        'date',
                        'flow',
                        'global',
                        'str',
                        'num',
                        'bool',
                        'json',
                        'bin',
                        'env',
                        'jsonata',
                        types.SunCalc,
                        types.MoonCalc,
                        types.MoonPhase
                    ]
                });

                // #endregion default
                // #region rules

                /**
                 * resizes a rule container
                 */
                function resizeContainer() {
                    try {
                        const editorRow = $('.node-input-rule-container-row ol');
                        const height = editorRow.outerHeight(true);
                        const rows = $('#node-input-rule-container').editableList('items');
                        if (rows.size() > 0) {
                            $('#node-input-rule-container').editableList('height', height + 40);
                        } else {
                            $('#node-input-rule-container').editableList('height', 20);
                        }
                    } catch (ex) {
                        console.log(ex); // eslint-disable-line
                    }
                }

                $('#node-input-rule-container').css('min-height', '40px').css('min-width', '300px').editableList({
                    addItem(containerRow, containerIndex, data) {
                        data.index = containerIndex;
                        data.timeType = (data.timeType || types.TimeEntered.value);
                        data.timeValue = (data.timeValue || '');
                        data.timeLimited = (data.timeType !== 'none');

                        data.conditional = (data.validOperandAType !== 'none');

                        containerRow.css({ overflow: 'hidden', whiteSpace: 'nowrap' });
                        const $row1 = $('<div/>').appendTo(containerRow);
                        const $row2 = $('<div/>', { style: 'padding-top: 5px;' }).appendTo(containerRow);
                        const $row3 = $('<div/>', { style: 'padding-top: 5px;' }).appendTo(containerRow);
                        const $row4 = $('<div/>', { style: 'padding-top: 5px;' }).appendTo(containerRow);
                        const $row5 = $('<div/>', { style: 'padding-top: 5px;' }).appendTo(containerRow);
                        // #region row1 - property -- lbl - [none / Bedingung] - [compare]
                        addLabel($row1, 'node-input-rule-condOpA', 'fa fa-puzzle-piece', node._('time-control.label.ruleCondition'));
                        const $validOperandA = $('<input/>', {
                            class: 'node-input-rule-condOpA',
                            id: 'node-input-rule-condOpA' + containerIndex,
                            type: 'text',
                            value: (data.validOperandAValue || '')
                        }).appendTo($row1).typedInput({
                            default: (data.validOperandAType || types.Unlimited.value),
                            types: [types.Unlimited, 'msg', 'flow', 'global', 'env', 'jsonata', types.PhaseMoon]
                        });
                        const $validOperator = $('<select/>', {
                            class: 'node-input-rule-condOperator',
                            id: 'node-input-rule-condOperator' + containerIndex,
                            style: 'margin-left: 5px;'
                        }).appendTo($row1);
                        appendOptions(node, $validOperator, 'comparator');
                        $validOperator.val(data.validOperator || selFields.comparator[0].id);
                        const finalspan = $('<span/>',{style:'float: right;margin-top: 6px;'}).appendTo($row1);
                        finalspan.append('<span class="node-input-rule-index">'+(containerIndex+1)+'</span> ');
                        // #endregion row1
                        // #region row2 - property threshold -- lbl - [none / Bedingung]
                        addLabel($row2, 'node-input-rule-condOpB', 'fa fa-ellipsis-h', node._('time-control.label.ruleConditionThreshold'));
                        const $validOperandB = $('<input/>', {
                            class: 'node-input-rule-condOpB',
                            id: 'node-input-rule-condOpB' + containerIndex,
                            type: 'text',
                            value: (data.validOperandBValue || '')
                        }).appendTo($row2).typedInput({
                            default: (data.validOperandBType || 'num'),
                            types: ['num', 'str', 'bool', 'flow', 'global', 'env']
                        });
                        // #endregion row2
                        // #region row3 - time -- lbl - [from-to] - [start - time]
                        addLabel($row3, 'node-input-rule-time', 'fa fa-clock-o');
                        const $timeOperator = $('<select/>', {
                            class: 'node-input-rule-time-operator',
                            id: 'node-input-rule-time-operator' + containerIndex,
                            style: 'margin-left: 5px;'
                        }).appendTo($row3);
                        $timeOperator.append($('<option></option>').val(0).text(node._('time-control.label.ruleTimeUntil')));
                        $timeOperator.append($('<option></option>').val(1).text(node._('time-control.label.ruleTimeFrom')));
                        $timeOperator.val(data.timeOp || 0);
                        const $time = $('<input/>', {
                            class: 'node-input-rule-time',
                            id: 'node-input-rule-time' + containerIndex,
                            type: 'text',
                            value: data.timeValue
                        }).appendTo($row3).typedInput({
                            default: data.timeType,
                            types: [types.Undefined, types.TimeEntered, types.TimeSun, types.TimeMoon, 'msg', 'flow', 'global', 'env', 'jsonata']
                        });
                        // #endregion row3
                        // #region row4 - time -- [offset] - [multiplier]
                        addLabel($row4, 'node-input-rule-offset', 'fa fa-plus');
                        const $offset = $('<input/>', {
                            class: 'node-input-rule-offset',
                            // id: 'node-input-rule-offset' + containerIndex,
                            type: 'text',
                            value: (data.offsetValue || '')
                        }).appendTo($row4).typedInput({
                            default: (data.offsetType || types.Undefined.value),
                            types: [types.Undefined, 'num', 'msg', 'flow', 'global', 'env', 'jsonata']
                        }).change(() => { $time.change(); });
                        const $multiplier = $('<select/>', {
                            class: 'node-input-rule-multiplier',
                            id: 'node-input-rule-multiplier' + containerIndex
                        }).appendTo($row4);
                        appendOptions(node, $multiplier, 'multiplier', data => (data.id > 0));
                        $multiplier.val(data.multiplier || 60000);
                        // #endregion row4
                        // #region row5 - output -- [output]
                        addLabel($row5, 'node-input-rule-output', 'fa fa-window-maximize', node._('time-control.label.ruleOutput'));
                        $('<input/>', {
                            class: 'node-input-rule-output',
                            id: 'node-input-rule-output' + containerIndex,
                            type: 'text',
                            value: data.outputValue || ''
                        }).appendTo($row5).typedInput({
                            default: (data.outputType || 'str'),
                            types: [
                                'date',
                                'flow',
                                'global',
                                'str',
                                'num',
                                'bool',
                                'json',
                                'bin',
                                'env',
                                'jsonata',
                                types.SunCalc,
                                types.MoonCalc,
                                types.MoonPhase
                            ]
                        });
                        // #endregion row5
                        // #region fields changes
                        $time.change(() => {
                            const opType = $time.typedInput('type');
                            if (opType === types.Undefined.value) {
                                $timeOperator.hide();
                                $row4.hide(); // offset
                            } else if (opType === types.TimeSun.value || opType === types.TimeMoon.value) {
                                $timeOperator.show();
                                $row4.show(); // offset
                            } else {
                                $timeOperator.show();
                                $row4.hide(); // offset
                            }
                            getBackendData(d => {
                                if (d.value && d.value !== 'none') {
                                    const dv = new Date(d.value);
                                    $row3.attr('title', dv.toLocaleTimeString() + ' (' + dv.toISOString() + ')');
                                    $time.attr('timedata', dv.getTime());
                                } else {
                                    $row3.attr('title', d.value);
                                    $time.attr('timedata', '0');
                                }
                            }, {
                                kind: 'getTimeData',
                                config : $nodeConfig.val(),
                                type: opType,
                                value: $time.typedInput('value'),
                                offsetType: $offset.typedInput('type'),
                                offset: $offset.typedInput('value'),
                                multiplier: $multiplier.val()
                            });
                            resizeContainer();
                        });
                        $validOperandA.change(() => {
                            const propType = $validOperandA.typedInput('type');
                            if (propType === 'none') {
                                $validOperator.val(selFields.comparator[0].id);
                                $validOperator.hide();
                                $row2.hide(); // condOpB
                            } else if ( propType === 'jsonata' || propType === types.PhaseMoon.value) {
                                $validOperator.show();
                                $validOperator.attr('disabled', true);
                                $validOperator.val(selFields.comparator[0].id); // only true is valid for jsonata
                                $row2.hide(); // condOpB
                            } else {
                                $validOperator.show();
                                $validOperator.attr('disabled', false);
                                const condOp = $validOperator.val();
                                let operatorCount = 1;
                                const fields = selFields.comparator;
                                const fieldsLength = fields.length;
                                for (let index = 0; index < fieldsLength; index++) {
                                    const el = fields[index];
                                    if (el.id === condOp) {
                                        operatorCount = el.operatorCount;
                                        break;
                                    }
                                }
                                if (operatorCount > 1) {
                                    $row2.show(); // condOpB
                                } else {
                                    $row2.hide(); // condOpB
                                }

                            }
                            $validOperandB.change();
                            resizeContainer();
                        });
                        $validOperator.change(() => { $validOperandA.change(); });
                        // #endregion fields changes
                        $validOperandA.change();
                        $time.change();
                        resizeRule(containerRow);
                    },
                    addButton: false,
                    resizeItem: resizeRule,
                    sortable: true,
                    removable: true,
                    scrollOnAdd: true,
                    removeItem(_opt) {
                        const rules = $('#node-input-rule-container').editableList('items');
                        rules.each(function(i) {
                            $(this).find('.node-input-rule-index').html(i+1);
                            const data = $(this).data('data');
                            data.index = i;
                        });
                        resizeContainer();
                    },
                    sortItems(_rules) {
                        const rules = $('#node-input-rule-container').editableList('items');
                        rules.each(function(i) {
                            $(this).find('.node-input-rule-index').html(i+1);
                            const data = $(this).data('data');
                            data.index = i;
                        });
                    }
                });

                // #region Button
                const $btnAdd = $('#node-button-add');
                $btnAdd.click(() => {
                    $('#node-input-rule-container').editableList('addItem', {});
                });

                const $btnClear = $('#node-button-clear');
                $btnClear.click(() => {
                    $('#node-input-rule-container').editableList('empty');
                    resizeContainer();
                });

                const $btnSort = $('#node-button-sort');
                $btnSort.click(() => {
                    const prerules = $('#node-input-rule-container').editableList('items');
                    prerules.each(function(i) {
                        const data = $(this).data('data');
                        data.index = i;
                        data.conditional = ((data.validOperandAType !== 'none') ? 1 : 0);
                        data.timeLimited = ((data.timeType !== 'none') ? 1 : 0);
                        data.timeData = (parseFloat($(this).find('.node-input-rule-time').attr('timedata')) || 0);
                        data.timeOp = (data.timeLimited) ? (Number(data.timeOp) || 0) : -1;
                    });
                    /**
                     * 1 no time
                     * 2 time    - until
                     * 3 time    - from
                     */
                    $('#node-input-rule-container').editableList('sort', (a, b) => {
                        const pos = (a.index - b.index);
                        if (!a.timeLimited && !b.timeLimited) { // both not time limited
                            return pos;
                        }
                        // both are time limited
                        const top = (a.timeOp - b.timeOp);
                        if (top !== 0) {
                            return top; // from before until; not timeLimited before timeLimited (1-3)
                        }
                        // both same from/until type
                        const time = a.timeData - b.timeData;
                        if ((a.timeData !== 0) && (b.timeData !== 0) && (time !== 0)) { // time is different
                            return time;
                        }
                        return pos;
                    });
                    const postrules = $('#node-input-rule-container').editableList('items');
                    postrules.each(function(i) {
                        $(this).find('.node-input-rule-index').html(i+1);
                        const data = $(this).data('data');
                        data.index = i;
                    });
                });
                // #endregion Button
                // #endregion rules
                // #region Enhanced settings
                $('.spinner-noLimit').spinner();
                $('.spinner-time').spinner({
                    max: 1439,
                    min: 0,
                    step: 1
                });
                // #endregion Enhanced settings
                // fill rules
                if (node.rules) {
                    for (let i = 0; i < node.rules.length; i++) {
                        const rule = node.rules[i];
                        $('#node-input-rule-container').editableList('addItem', rule);
                    }
                    setTimeout(() => {
                        const postrules = $('#node-input-rule-container').editableList('items');
                        postrules.each(function (_i) {
                            resizeRule($(this));
                        });
                        resizeContainer();
                    }, 1500);
                }
            }; // setup
            $.getScript('sun-position/js/htmlglobal.js')
                .done((_data, _textStatus, _jqxhr) => {
                    try {
                        setup(node);
                    } catch (err) {
                        console.log("failed to setup editor"); // eslint-disable-line
                        console.log(err); // eslint-disable-line
                        console.log(err.stack); // eslint-disable-line
                    }
                })
                .fail((jqxhr, settings, exception) => {
                    console.log("failed to load htmlglobal.js"); // eslint-disable-line
                    console.log(exception); // eslint-disable-line
                    console.log(exception.stack); // eslint-disable-line
                });
        },
        oneditsave() {
            const node = this;
            node.rules = saveRules($('#node-input-rule-container').editableList('items'));

            const overwriteExpire = parseFloat($('#time-control-overwriteExpire').val());
            if (isNaN(overwriteExpire) || overwriteExpire === '' || overwriteExpire === 0) {
                $('#node-input-overwriteExpire').val('');
            } else {
                let val = overwriteExpire * parseFloat($('#time-control-overwriteExpire-multiplier').val());
                if (val < 1000) {
                    val = 1000;
                }
                $('#node-input-overwriteExpire').val(val);
            }
        },
        oneditresize(_size) {
            if (typeof $().editableList !== 'undefined') {
                const postrules = $('#node-input-rule-container').editableList('items');
                postrules.each(function(_i) {
                    resizeRule($(this));
                });
            }
        }
    });</script>

<script type="text/x-red" data-template-name="time-control">
    <div class="form-row block-noindent" data-i18n="[title]node-red-contrib-sun-position/position-config:common.placeholder.positionConfig">
        <label for="node-input-positionConfig"><i class="fa fa-globe"></i> <span data-i18n="node-red-contrib-sun-position/position-config:common.label.positionConfig"></span></label>
        <input type="text" class="row-full-width" id="node-input-positionConfig">
    </div>
    <hr>
    <!-- time ######################################################################## -->
    <div class="is-to-show-initially">
        <label for="node-input-rule-container-row"><i class="fa fa-list"></i> <span data-i18n="[html]time-control.text.time"></span></span></label>
        <div class="form-row node-input-rule-container-row row-full-width">
            <ol id="node-input-rule-container"></ol>
            <button type="button" id="node-button-add" class="rdg-ui-btn red-ui-button red-ui-button-small" data-i18n="[title]time-control.placeholder.btnAdd" style="margin-top: 4px;"><i class="fa fa-plus"></i> <span data-i18n="time-control.label.btnAdd"></span></button> &nbsp;
            <button type="button" id="node-button-clear" class="rdg-ui-btn red-ui-button red-ui-button-small" data-i18n="[title]time-control.placeholder.btnClear" style="margin-top: 4px;"><i class="fa fa-eraser"></i> <span data-i18n="time-control.label.btnClear"></span></button> &nbsp;
            <button type="button" id="node-button-sort" class="rdg-ui-btn red-ui-button red-ui-button-small" data-i18n="[title]time-control.placeholder.btnSort" style="margin-top: 4px;"><i class="fa fa-sort-amount-asc"></i> <span data-i18n="time-control.label.btnSort"></span></button>
        </div>
    </div>

    <div class="form-row block-noindent is-to-show-initially">
        <span data-i18n="[html]time-control.text.outputDefault" class="row-full-width"></span>
    </div>
    <div class="form-row block-noindent is-to-show-initially" data-i18n="[title]time-control.placeholder.outputDefault">
        <label for="node-input-outputDefault"><i class="fa fa-angle-down"></i> <span data-i18n="time-control.label.outputDefault"></span></label>
        <input type="text" id="node-input-outputDefault" class="row-full-width" data-i18n="[placeholder]time-control.placeholder.outputDefault"/>
        <input type="hidden" id="node-input-outputDefaultType">
    </div>
    <hr>
    <!-- overwrite time ######################################################################## -->
    <div class="form-row block-noindent is-to-show-initially">
        <span data-i18n="[html]time-control.text.overwrite" class="row-full-width"></span>
    </div>
    <div class="form-row row-overwriteValue block-indent1" data-i18n="[titel]time-control.placeholder.overwriteExpire">
        <label for="time-control-overwriteExpire"><i class="fa fa-clock-o"></i> <span data-i18n="time-control.label.overwriteExpire"></span></label>
        <input type="text" class="spinner-time" id="time-control-overwriteExpire" data-i18n="[placeholder]time-control.placeholder.overwriteExpire" value=""/>
        <select id="time-control-overwriteExpire-multiplier" class="node-input-multiplier">
            <option value="1000" data-i18n="node-red-contrib-sun-position/position-config:common.multiplier.1"></option>
            <option value="60000" data-i18n="node-red-contrib-sun-position/position-config:common.multiplier.2"></option>
            <option value="3600000" data-i18n="node-red-contrib-sun-position/position-config:common.multiplier.3"></option>
        </select>
        <input type="hidden" id="node-input-overwriteExpire">
    </div>
    <hr>
    <!-- Enhanced ######################################################################## -->
    <div class="form-row block-noindent" data-i18n="[title]time-control.placeholder.outputs">
        <label for="node-input-outputs"><i class="fa fa-random"></i> <span data-i18n="time-control.label.outputs"></span></label>
        <select id="node-input-outputs" class="row-full-width">
            <option value="1" data-i18n="time-control.label.singleOutput"></option>
            <option value="2" data-i18n="time-control.label.splitOutput"></option>
        </select>
    </div>
    <hr>
    <!-- End ######################################################################## -->
    <div class="form-row block-noindent time-topic" data-i18n="[title]node-red:common.label.topic">
        <label for="node-input-topic"><i class="fa fa-tasks"></i> <span data-i18n="node-red:common.label.topic"></span></label>
        <input type="text" id="node-input-topic" class="row-full-width" data-i18n="[placeholder]node-red:common.label.topic"/>
    </div>
    <div class="form-row block-noindent" data-i18n="[title]node-red:common.label.name">
        <label for="node-input-name"><i class="icon-tag"></i> <span data-i18n="node-red:common.label.name"></span></label>
        <input type="text" id="node-input-name" class="row-full-width" data-i18n="[placeholder]node-red:common.label.name"/>
    </div>

    <!-- DIALOG ######################################################################## -->
    <!--
    <div id="dialog-select-context" title="Select Channel and Datapoint">
        <div id="config-lookup-tree"></div>
    </div>
    -->
</script>
<style>
    hr {
        width: 100%
    }
    .is-to-show-initially {
        display:none
    }
    .is-initial-hidden {
        display:none
    }
    .form-tips {
        width: 90%
    }
    .block-indent1 {
        float: left;
        min-height: 1px;
        margin-left: 10px;
        width: 100%
    }
    .block-indent1-noadd {
        float: left;
        min-height: 1px;
        margin-left: 10px;
        width: 100%
    }
    .input-error {
        border-color: #d6615f !important;
        background-color: #ffcccc !important;
    }

    .block-indent2 {
        float: left;
        min-height: 1px;
        margin-left: 20px;
        width: 100%
    }
    .block-indent2-noadd {
        float: left;
        min-height: 1px;
        margin-left: 20px;
        width: 100%
    }
    .block-noindent .row-full-width {
        width : calc(100% - 110px);
    }
    .block-indent1 .row-full-width {
        width : calc(100% - 120px);
    }
    .block-indent2 .row-full-width {
        width : calc(100% - 130px);
    }
    .block-noindent .ui-spinner {
        width : calc(100% - 245px);
    }
    .block-indent1 .ui-spinner {
        width : calc(100% - 255px);
    }
    .block-indent2 .ui-spinner {
        width : calc(100% - 265px);
    }
    .block-noindent-noadd .ui-spinner {
        width : calc(100% - 110px);
    }
    .block-indent1-noadd .ui-spinner {
        width : calc(100% - 120px);
    }
    .block-indent2-noadd .ui-spinner {
        width : calc(100% - 130px);
    }
    .node-input-multiplier {
        width: 125px;
        max-width: 125px;
        margin-left: 5px;
    }
    .node-input-addOn {
        width: 100px;
        max-width: 100px;
        margin-left: 5px;
    }
    .ui-spinner input {
        border: none !important;
        width: 95% !important;
    }
</style>