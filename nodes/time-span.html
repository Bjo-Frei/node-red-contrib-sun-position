<script type="text/x-red" data-template-name="time-span">
  <div class="form-row">
    <label for="node-input-positionConfig"><i class="fa fa-globe"></i> <span data-i18n="time-span.label.position"></span></label>
    <input type="text" id="node-input-positionConfig">
    <input type="hidden" id="node-input-outputs"/>
  </div>
  <hr>
  <div class="form-row block-noindent time-operand1">
      <label for="node-input-operand1"><i class="fa fa-ellipsis-h"></i> <span data-i18n="time-span.label.operand1"></span></label>
      <input type="text" id="node-input-operand1">
      <input type="hidden" id="node-input-operand1Type">
  </div>
  <div class="form-row block-indent1 time-row-operand1Format hidden">
      <label for="node-input-operand1Formatsel"><i class="fa fa-sign-in"></i> <span data-i18n="time-span.label.operand1Format"></span></label>
      <select id="node-input-operand1Formatsel" >
      <input type="text" id="node-input-operand1Format" style="margin-left: 5px;"></input>
  </div>
  <div class="form-row block-indent1 time-row-operand1Offset hidden">
      <label for="node-input-operand1Offset"><i class="fa fa-calculator"></i> <span data-i18n="time-span.label.operand1Offset"></span></label>
      <input id="node-input-operand1Offset" class="row-partly-width" data-i18n="[placeholder]time-span.placeholder.offset"></input>
      <input type="hidden" id="node-input-operand1OffsetType">
      <select id="node-input-operand1OffsetMultiplier" class="node-input-multiplier"></select>
  </div>
  <hr>
  <div class="form-row block-noindent time-operand2">
      <label for="node-input-operand2"><i class="fa fa-ellipsis-h"></i> <span data-i18n="time-span.label.operand2"></span></label>
      <input type="text" id="node-input-operand2">
      <input type="hidden" id="node-input-operand2Type"></input>
  </div>
  <div class="form-row block-indent1 time-row-operand2Format hidden">
      <label for="node-input-operand2Formatsel"><i class="fa fa-sign-in"></i> <span data-i18n="time-span.label.operand2Format"></span></label>
      <select id="node-input-operand2Formatsel">
      <input type="text" id="node-input-operand2Format" style="margin-left: 5px;">
  </div>
  <div class="form-row block-indent1 time-row-operand2Offset hidden">
      <label for="node-input-operand2Offset"><i class="fa fa-calculator"></i> <span data-i18n="time-span.label.operand2Offset"></span></label>
      <input id="node-input-operand2Offset" class="row-partly-width" data-i18n="[placeholder]time-span.placeholder.offset">
      <input type="hidden" id="node-input-operand2OffsetType">
      <select id="node-input-operand2OffsetMultiplier" class="node-input-multiplier"></select>
  </div>
  <hr>
  <div>
    <label for="node-input-rule-container-row"><i class="fa fa-list"></i> <span data-i18n="time-span.label.operatorContainer"></span></label>
    <div class="form-row node-input-rule-container-row">
      <ol id="node-input-rule-container"></ol>
    </div>
  </div>
  <div class="form-row">
      <select id="node-input-checkall" style="width:100%; margin-right:5px;">
          <option value="false" data-i18n="time-span.label.stopfirst"></option>
          <option value="true" data-i18n="time-span.label.checkall"></option>
      </select>
  </div>
  <hr>
  <div class="form-row block-noindent time-result1">
      <label for="node-input-result1"><i class="fa fa-terminal"></i> <span data-i18n="time-span.label.result1"></span></label>
      <input type="text" id="node-input-result1" class="row-full-width">
      <input type="hidden" id="node-input-result1Type">
  </div>
  <div class="form-row block-indent1 time-result1Value hidden">
      <label for="node-input-result1Value"><i class="fa fa-envelope-o"></i> <span data-i18n="time-span.label.result1Value"></span></label>
      <input type="text" id="node-input-result1Value" class="row-full-width">
      <input type="hidden" id="node-input-result1ValueType">
  </div>
  <div class="form-row block-indent2 time-row-result1TSFormat hidden">
    <label for="node-input-result1TSFormatSel"><i class="fa fa-sign-out"></i> <span data-i18n="time-span.label.result1TSFormat"></span></label>
    <select id="node-input-result1TSFormatSel">
    </select>
    <input type="text" id="node-input-result1TSFormat" class="form-row time-input-result1TSFormat hidden" style="margin-left: 5px;">
</div>
  <div class="form-row block-indent2 time-row-result1Format hidden">
      <label for="node-input-result1FormatSel"><i class="fa fa-sign-out"></i> <span data-i18n="time-span.label.result1Format"></span></label>
      <select id="node-input-result1FormatSel">
      </select>
      <input type="text" id="node-input-result1Format" style="margin-left: 5px;">
  </div>
  <div class="form-row block-indent2 time-row-result1Offset hidden">
      <label for="node-input-result1Offset"><i class="fa fa-calculator"></i> <span data-i18n="time-span.label.result1Offset"></span></label>
      <input id="node-input-result1Offset" class="row-partly-width" data-i18n="[placeholder]time-span.placeholder.offset">
      <input type="hidden" id="node-input-result1OffsetType">
      <select id="node-input-result1OffsetMultiplier" class="node-input-multiplier">
      </select>
  </div>
  <hr>
  <div class="form-row">
      <label for="node-input-name"><i class="icon-tag"></i> <span data-i18n="time-span.label.name"></span></label>
      <input type="text" id="node-input-name" data-i18n="[placeholder]time-span.placeholder.name">
  </div>
</script>
<style>
    hr {
        width: 100%
    }
    .block-indent1 {
        float: left;
        min-height: 1px;
        margin-left: 10px;
        width: 100%
    }
    .block-indent2 {
        float: left;
        min-height: 1px;
        margin-left: 20px;
        width: 100%
    }
    .block-noindent .row-full-width {
        width : calc(100% - 110px);
    }
    .block-indent1 .row-full-width {
        width : calc(100% - 120px);
    }
    .block-indent2 .row-full-width {
        width : calc(100% - 130px);
    }
    .block-noindent .row-partly-width {
        width : calc(100% - 245px);
    }
    .block-indent1 .row-partly-width {
        width : calc(100% - 255px);
    }
    .block-indent2 .row-partly-width {
        width : calc(100% - 265px);
    }
    .block-noindent .ui-spinner {
        width : calc(100% - 245px);
    }
    .block-indent1 .ui-spinner {
        width : calc(100% - 255px);
    }
    .block-indent2 .ui-spinner {
        width : calc(100% - 265px);
    }
    .node-input-rule-operator {
        width: 60px;
        margin-left: 5px;
        text-align: center;
    }
    .node-input-rule-operand {
        margin-left: 5px;
    }
    .node-input-rule-multiplier {
        width: 125px;
        margin-left: 5px;
    }
    .node-input-multiplier {
        width: 125px;
        margin-left: 5px;
    }
</style>
<script type="text/x-red" data-help-name="time-comp"> <p>A enhanced node for time format change and time comparision.</p>
    <h3>Input</h3>
        <p>When a message arrives through the Input a timestamp out of the message objet or a global or flow context store could be parsed into a timestamp.</p>
    <h3>Outputs</h3>
        <p>Outputs the Input message, where the posibility exists to change a property of the input message (or a global/flow context). If a time conversation is done the input message would be output to the according output where the timestamp is matching.</p>
  <h3>References</h3>
  Enhanced documentation can be found in the following locations:
  <ul>
      <li><a href="https://github.com/HM-RedMatic/node-red-contrib-sun-position">GitHub</a> - the nodes github repository</li>
      <li><a href="https://flows.nodered.org/node/node-red-contrib-sun-position">Node-Red</a> - the Node-Red Node overview</li>
      <li><a href="https://flows.nodered.org/node/node-red-contrib-sun-position">NPM</a> - the nodes npm node description</li>
  </ul>
  With friendly support by <b>agag</b>.
</script>
<script type="text/javascript">
    function clipValueLength(v, l) {
        if (v.length > l) {
            return v.substring(0, l - 3) + '...';
        }

        return v;
    }

    function getValueLabel(t, v, l) {
        l = l || 15;
        if (t === 'string' || t === 'str') {
            if (v === '') { return v; }
            return '"' + clipValueLength(v, l) + '"';
        }

        if (t === 'num' || t === 'bool') {
            if (v === '') { return v; }
            return String(v);
        }

        if (t === 'msg') {
            return t + '.' + clipValueLength(v, l);
        }
        if (t === 'msgPayload') {
            return 'msg.payload';
        }
        if (t === 'msgTs') {
            return 'msg.ts';
        }

        if (t === 'flow' || t === 'global') {
            const result = RED.utils.parseContextKey(v);
            return t + '.' + clipValueLength(result.key, l);
        }
        if (t === 'timespan') {
            return 'timespan';
        }
        if (t === 'operand1') {
            return 'operand1 data';
        }
        if (t === 'operand2') {
            return 'operand2 data';
        }

        if (t === 'pdsCalcData') {
            return '{sun position}';
        }

        if (t === 'pdmCalcData') {
            return '{moon position}';
        }

        if (t === 'pdsTime') {
            const res = v.replace('astronomical', 'astro-').replace('nautical', 'naut-').replace('civil', '').replace('amateur', 'amat-').replace('blueHour', 'blHr-').replace('goldenHour', 'goHr-');
            return clipValueLength(res, l);
        }

        if (t === 'pdmTime') {
            return 'moon' + v;
        }

        return clipValueLength(v, l);
    }

    RED.nodes.registerType('time-span', {
        category: 'time and astro',
        color: '#EDFDBF',
        icon: 'time-span-black.png',
        inputs: 1,
        outputs: 1,
        defaults: {
            outputs: {
                value: 1
            },
            name: {
                value: '',
                required: false
            },
            positionConfig: {
                value: '',
                type: 'position-config',
                required: true
            },
            // #region operand1
            operand1: {
                value: 'payload',
                validate: RED.validators.typedInput('operand1Type')
            },
            operand1Type: {
                value: 'msgPayload'
            },
            operand1Format: {
                value: 0,
                required: true,
                validate(v) {
                    return (v !== '') || typeof v === 'undefined';
                }
            },
            operand1Offset: {
                value: 0,
                required: true,
                validate: RED.validators.number() || $('#node-input-operand1OffsetType').typedInput('type') === 'none' || this.operand1OffsetType === 'none'
            },
            operand1OffsetType: {
                value: 'none'
            },
            operand1OffsetMultiplier: {
                value: 60000,
                required: true,
                validate: RED.validators.number() || $('#node-input-operand1OffsetType').typedInput('type') === 'none' || this.operand1OffsetType === 'none'
            },
            // #endregion operand1
            // #region operand2
            operand2: {
                value: '',
                validate: RED.validators.typedInput('inputType')
            },
            operand2Type: {
                value: 'msg'
            },
            operand2Format: {
                value: 0,
                required: true,
                validate(v) {
                    return (v !== '') || typeof v === 'undefined';
                }
            },
            operand2Offset: {
                value: 0,
                required: true,
                validate: RED.validators.number() || $('#node-input-operand2OffsetType').typedInput('type') === 'none' || this.operand2OffsetType === 'none'
            },
            operand2OffsetType: {
                value: 'none'
            },
            operand2OffsetMultiplier: {
                value: 60000,
                required: true,
                validate: RED.validators.number() || $('#node-input-operand2OffsetType').typedInput('type') === 'none' || this.operand2OffsetType === 'none'
            },
            // #endregion operand2
            // #region rules
            rules: {
                value: [{
                    operator: 1,
                    operatorText: '==',
                    operandType: 'num',
                    operandValue: '',
                    multiplier: 60000
                }]
            },
            checkall: {
                value: 'true',
                required: true
            },
            // #endregion rules
            // #region result1
            result1: {
                value: 'payload',
                validate: RED.validators.typedInput('result1Type')
            },
            result1Type: {
                value: 'msgPayload'
            },
            result1Value: {
                value: '',
                validate(v) {
                    return (RED.validators.typedInput('result1ValueType')(v) || $('#node-input-result1').typedInput('type') === 'none' || this.result1Type === undefined);
                }
            },
            result1ValueType: {
                value: 'timespan'
            },
            result1TSFormat: {
                value: 1,
                required: false,
                validate(v) {
                    return ((v !== '') || $('#node-input-result1').typedInput('type') === 'none' || this.result1Type === undefined);
                }
            },
            result1Format: {
                value: 0,
                required: false,
                validate(v) {
                    return ((v !== '') || $('#node-input-result1').typedInput('type') === 'none' || this.result1Type === undefined);
                }
            },
            result1Offset: {
                value: 0,
                required: true,
                validate: RED.validators.number() || $('#node-input-result1OffsetType').typedInput('type') === 'none' || this.result1OffsetType === 'none'
            },
            result1OffsetType: {
                value: 'none'
            },
            result1OffsetMultiplier: {
                value: 60000,
                required: true,
                validate: RED.validators.number() || $('#node-input-result1OffsetType').typedInput('type') === 'none' || this.result1OffsetType === 'none'
            }
            // #endregion result1
        },
        outputLabels(index) {
            if (this.rules.length) {
                const rule = this.rules[index];
                if (rule) {
                    return rule.operatorText + ' ' + getValueLabel(rule.operandType, rule.operandValue);
                }
                if (this.checkall === 'true') {
                    return 'always';
                }
                return 'otherwise';
                // return ["msg if comparision is true", "msg if comparision is false"];
            }

            return 'input msg after evaluation';
        },
        label() {
            if (this.name) {
                return this.name;
            }
            if (!this.rules || this.rules.length <= 1) {
                const op1 = getValueLabel(this.operand1Type, this.operand1);
                const op2 = getValueLabel(this.operand2Type, this.operand2);
                return op1 + ' - ' + op2;
            } else if (this.rules && this.rules.length === 1) {
                const op1 = getValueLabel(this.operand1Type, this.operand1);
                const op2 = getValueLabel(this.operand2Type, this.operand2);
                const cmp = getValueLabel(this.rules[0].operandType, this.rules[0].operandValue);
                return op1 + ' - ' + op2 + ' ' + this.rules[0].operatorText + ' ' + cmp;
            } else if (this.rules && this.rules.length > 1) {
                const op1 = getValueLabel(this.operand1Type, this.operand1);
                const op2 = getValueLabel(this.operand2Type, this.operand2);
                return op1 + ' - ' + op2 + + ' ' + this._('time-span.label.compare');
            }
            return this._('time-span.label.time-span');
        },
        labelStyle() {
            return this.name ? 'node_label_italic' : '';
        },
        paletteLabel: 'time span',
        align: 'left',
        oneditprepare() {
            const node = this;
            // #region definition
            const SelectFields = {
                operatorsGroups: [
                    {id: 'cmp', label: 'compate Timestamp'}
                ],
                operators: [
                    {id: 1, group: 'cmp', label: '==', text: 'equal'},
                    {id: 2, group: 'cmp', label: '!=', text: 'unequal'},
                    {id: 3, group: 'cmp', label: '>', text: 'greater'},
                    {id: 4, group: 'cmp', label: '>=', text: 'greater or equal'},
                    {id: 5, group: 'cmp', label: '<', text: 'lesser'},
                    {id: 6, group: 'cmp', label: '<=', text: 'lesser or equal'}
                ], outputTSFormatsGroups: [
                    {id: 'time', label: 'timestamp (number)'},
                    {id: 'timeround', label: 'timestamp rounded (number)'},
                    {id: 'string', label: 'Text'}
                ], outputTSFormats: [
                    {id: 0, group: 'time', name: 'ms', label: 'milliseconds'},
                    {id: 1, group: 'time', name: 'sec', label: 'seconds'},
                    {id: 2, group: 'time', name: 'min', label: 'minutes'},
                    {id: 3, group: 'time', name: 'hour', label: 'hours'},
                    {id: 4, group: 'time', name: 'days', label: 'days'},
                    {id: 5, group: 'time', name: 'weeks', label: 'weeks'},
                    {id: 6, group: 'time', name: 'month', label: 'month'},
                    {id: 7, group: 'time', name: 'years', label: 'years'},
                    {id: 11, group: 'timeround', name: 'sec', label: 'seconds'},
                    {id: 12, group: 'timeround', name: 'min', label: 'minutes'},
                    {id: 13, group: 'timeround', name: 'hour', label: 'hours'},
                    {id: 14, group: 'timeround', name: 'days', label: 'days'},
                    {id: 15, group: 'timeround', name: 'weeks', label: 'weeks'},
                    {id: 16, group: 'timeround', name: 'month', label: 'month'},
                    {id: 17, group: 'timeround', name: 'years', label: 'years'},
                    {id: 99, group: 'string', name: 'Other', label: 'Other'}
                ], outputFormatsGroups: [
                    {id: 'number', label: 'Number'},
                    {id: 'string', label: 'Text (string)'},
                    {id: 'time', label: 'time (number) since emit'},
                    {id: 'dayofweek', label: 'day of week'},
                    {id: 'other', label: 'Other'}
                ], outputFormats: [
                    {id: 0, group: 'number', name: 'UNIX', label: 'milliseconds UNIX timestamp'},
                    {id: 10, group: 'number', name: 'YYYYMMDDHHMMSS', label: 'YYYYMMDDHHMMSS'},
                    {id: 11, group: 'number', name: 'YYYYMMDD_HHMMSS', label: 'YYYYMMDD.HHMMSS'},
                    {id: 1, group: 'string', name: 'ECMA262', label: 'ECMA-262', add: 'standard JSON Date representation'},
                    {id: 2, group: 'string', name: 'local', label: 'local date and time'},
                    {id: 14, group: 'string', name: 'localLong', label: 'local date and time enh.'},
                    {id: 3, group: 'string', name: 'localTime', label: 'local time'},
                    {id: 13, group: 'string', name: 'localTimeLong', label: 'ocal time enh.'},
                    {id: 12, group: 'string', name: 'localDate', label: 'local date'},
                    {id: 15, group: 'string', name: 'localDateLong', label: 'local date long'},
                    {id: 4, group: 'string', name: 'UTC', label: 'UTC date and time'},
                    {id: 5, group: 'string', name: 'ISO', label: 'ISO date and time'},
                    {id: 6, group: 'time', name: 'ms', label: 'milliseconds'},
                    {id: 7, group: 'time', name: 'sec', label: 'seconds'},
                    {id: 8, group: 'time', name: 'min', label: 'minutes'},
                    {id: 9, group: 'time', name: 'hour', label: 'hours'},
                    {id: 16, group: 'dayofweek', name: 'Day Name', label: 'Day Name, e.g. Monday, 22.12.'},
                    {id: 17, group: 'dayofweek', name: 'Day', label: 'Day in relative, e.g. Today, 22.12.'},
                    {id: -1, group: 'other', name: 'object', label: 'as object'},
                    {id: 99, group: 'other', name: 'free definition', label: 'Other'}
                ], parseFormatsGroups: [
                    {id: 'number', label: 'Number'},
                    {id: 'string', label: 'Text (string)'},
                    {id: 'other', label: 'Other'}
                ], parseFormats: [
                    {id: 0, group: 'number', label: 'milliseconds UNIX timestamp', add: 'xxx'},
                    {id: 1, group: 'string', label: 'ECMA-262', add: 'standard JSON Date representation'},
                    {id: 2, group: 'string', label: 'various - try different Formats, prefere european formats', add: 'will try different formats, prefere european formats'},
                    {id: 3, group: 'string', label: 'various - try different Formats, prefere american formats', add: 'will try different formats, prefere european formats'},
                    {id: 4, group: 'number', label: 'YYYYMMDDHHMMSS', add: 'xxx'},
                    {id: 5, group: 'number', label: 'YYYYMMDD.HHMMSS', add: 'xxx'},
                    {id: 99, group: 'other', label: 'free definition', add: 'xxx'}
                ], multiplierGroups: [
                    {id: 'std', label: 'Standard'},
                    {id: 'other', label: 'Special'}
                ], multiplier: [
                    {id: 1, group: 'std', label: 'milliseconds'},
                    {id: 1000, group: 'std', label: 'seconds'},
                    {id: 60000, group: 'std', label: 'minutes'},
                    {id: 3600000, group: 'std', label: 'hours'},
                    {id: 86400000, group: 'std', label: 'days'},
                    {id: 604800000, group: 'other', label: 'weeks'},
                    {id: -1, group: 'other', label: 'month'},
                    {id: -2, group: 'other', label: 'year'}
                ]
            };
            const typeUndefined = {
                value: 'none',
                label: 'not used',
                // icon: "icons/node-red-contrib-sun-position/inputTypeNone.png",
                hasValue: false
            };
            const typeMsgPayload = {
                value: 'msgPayload',
                label: 'msg.payload',
                hasValue: false
            };
            const typeMsgTs = {
                value: 'msgTs',
                label: 'msg.ts',
                hasValue: false
            };
            const typeTimeEntered = {
                value: 'entered',
                label: 'time (current day)',
                icon: 'icons/node-red-contrib-sun-position/inputTypeTime.png',
                hasValue: true,
                validate: /^(0\d|\d|1\d|2[0-3])(?::([0-5]\d|\d))?(?::([0-5]\d|\d))?\s*(pm?)?$/
            };
            const typeDateEntered = {
                value: 'dateEntered',
                label: 'date',
                icon: 'icons/node-red-contrib-sun-position/inputTypeDate.png',
                hasValue: true
            };
            const typeDayOfMonth = {
                value: 'DayOfMonth',
                label: 'day of month',
                options: [
                    'first Monday',
                    'first Tuseday',
                    'first Wednesday',
                    'first Thursday',
                    'first Friday',
                    'first Saturday',
                    'first Sunday',
                    'last Monday',
                    'last Tuseday',
                    'last Wednesday',
                    'last Thursday',
                    'last Friday',
                    'last Saturday',
                    'last Sunday'
                ]
            };
            const typeTimeSun = {
                value: 'pdsTime',
                label: 'sun time ',
                icon: 'icons/node-red-contrib-sun-position/inputTypeSunClock.png',
                options: [ 'astronomicalDawn', 'amateurDawn', 'nauticalDawn', 'blueHourDawnStart', 'civilDawn', 'blueHourDawnEnd',
                    'sunrise', 'sunriseEnd', 'goldenHourEnd', 'solarNoon', 'goldenHourStart', 'sunsetStart', 'sunset', 'blueHourDuskStart',
                    'civilDusk', 'blueHourDuskEnd', 'amateurDusk', 'astronomicalDusk', 'nadir']
            };
            const typeTimeMoon = {
                value: 'pdmTime',
                label: 'moon time ',
                icon: 'icons/node-red-contrib-sun-position/inputTypeMoonClock.png',
                options: ['rise', 'set']
            };
            const typeSunCalc = {
                value: 'pdsCalcData',
                label: 'sun caclucaltion',
                icon: 'icons/node-red-contrib-sun-position/inputTypeSun.png',
                hasValue: false
            };
            const typeMoonCalc = {
                value: 'pdmCalcData',
                label: 'moon caclucaltion',
                icon: 'icons/node-red-contrib-sun-position/inputTypeMoon.png',
                hasValue: false
            };
            const dateParseFormat = [
                {label: 'yy   Year (2 digits)', value: 'yy'},
                {label: 'yyyy Year (4 digits)', value: 'yyyy'},
                {label: 'M    Month (1 digit)', value: 'M'},
                {label: 'MM   Month (2 digits)', value: 'MM'},
                {label: 'MMM  Month (name or abbr.)', value: 'MMM'},
                {label: 'NNN  Month (abbr.)', value: 'NNN'},
                {label: 'd    Day of Month (1 digit)', value: 'd'},
                {label: 'dd   Day of Month (2 digits)', value: 'dd'},
                {label: 'E    Day of Week (abbr)', value: 'E'},
                {label: 'EE   Day of Week (name)', value: 'EE'},
                {label: 'h    Hour (1 digit 1-12)', value: 'h'},
                {label: 'hh   Hour (2 digits 1-12)', value: 'hh'},
                {label: 'H    Hour (1 digit 0-23)', value: 'H'},
                {label: 'HH   Hour (2 digits 0-23)', value: 'HH'},
                {label: 'K    Hour (1 digit 0-11)', value: 'K'},
                {label: 'KK   Hour (2 digits 0-11)', value: 'KK'},
                {label: 'k    Hour (1 digit 1-24)', value: 'k'},
                {label: 'kk   Hour (2 digits 1-24)', value: 'kk'},
                {label: 'm    Minute (1 digit)', value: 'm'},
                {label: 'mm   Minute (2 digits)', value: 'mm'},
                {label: 's    Second (1 digit)', value: 's'},
                {label: 'ss   Second (2 digits)', value: 'ss'},
                {label: 'll   Milliseconds (2 digits)', value: 'll'},
                {label: 'lll  Milliseconds (3 digits)', value: 'lll'},
                {label: 't    AM/PM (1 digit)', value: 't'},
                {label: 'tt   AM/PM (2 digits)', value: 'tt'}];
            const dateOutTSFormat = [
                {label: 'd    Days (1 digit)', value: 'd'},
                {label: 'dd   Days (2 digits)', value: 'dd'},
                {label: 'td   total Days (1 digit)', value: 'td'},
                {label: 'tdd  total Days (2 digits)', value: 'tdd'},
                {label: 'h    Hours (1-12)', value: 'h'},
                {label: 'hh   Hours (2 digits 01-12)', value: 'hh'},
                {label: 'th   total Hours (1-12)', value: 'h'},
                {label: 'thh  total Hours (2 digits 01-12)', value: 'hh'},
                {label: 'H    Hours (0-23)', value: 'H'},
                {label: 'HH   Hours (2 digits 00-23)', value: 'HH'},
                {label: 'tH   total Hours (0-23)', value: 'H'},
                {label: 'tHH  total Hours (2 digits 00-23)', value: 'HH'},
                {label: 'K    Hours (0-11)', value: 'K'},
                {label: 'KK   Hours (2 digits 00-11)', value: 'KK'},
                {label: 'tK   total Hours (0-11)', value: 'K'},
                {label: 'tKK  total Hours (2 digits 00-11)', value: 'KK'},
                {label: 'k    Hours (1-24)', value: 'k'},
                {label: 'kk   Hours (2 digits 01-24)', value: 'kk'},
                {label: 'tk   total Hours (1-24)', value: 'k'},
                {label: 'tkk  total Hours (2 digits 01-24)', value: 'kk'},
                {label: 'm    Minutes (0-59)', value: 'm'},
                {label: 'mm   Minutes (2 digits 00-59)', value: 'mm'},
                {label: 'tm   total Minutes (0-59)', value: 'm'},
                {label: 'tmm  total Minutes (2 digits 00-59)', value: 'mm'},
                {label: 's    Second (0-59)', value: 's'},
                {label: 'ss   Second (2 digits 00-59)', value: 'ss'},
                {label: 'ts   total Second (0-59)', value: 's'},
                {label: 'tss  total Second (2 digits 00-59)', value: 'ss'},
                {label: 'l    Milliseconds (0-999)', value: 'l'},
                {label: 'll   Milliseconds (2 digits 00-99)', value: 'll'},
                {label: 'lll  Milliseconds (3 digits 000-999)', value: 'lll'},
                {label: 'tl   total Milliseconds (0-999)', value: 'l'},
                {label: 'tll  total Milliseconds (2 digits 00-99)', value: 'll'},
                {label: 'tlll total Milliseconds (3 digits 000-999)', value: 'lll'},
                {label: 't    AM/PM (1 digit - Lowercase)', value: 't'},
                {label: 'tt   AM/PM (2 digits - Lowercase)', value: 'tt'},
                {label: 'T    AM/PM (1 digit - Uppercase)', value: 'T'},
                {label: 'TT   AM/PM (2 digits - Uppercase)', value: 'TT'},
                {label: 'S    date\'s ordinal suffix (st, nd, rd, or th)', value: 'S'}];
            const dateOutFormat = [{label: 'yyyy Year (4 digits)', value: 'yyyy'},
                {label: 'yy   Year (2 digits)', value: 'yy'},
                {label: 'M    Month (1 digit)', value: 'M'},
                {label: 'MM   Month (2 digits)', value: 'MM'},
                {label: 'MMM  Month (abbr.)', value: 'MMM'},
                {label: 'NNN  Month (name)', value: 'NNN'},
                {label: 'd    Day of Month (1 digit)', value: 'd'},
                {label: 'dd   Day of Month (2 digits)', value: 'dd'},
                {label: 'E    Day of Week (abbr)', value: 'E'},
                {label: 'EE   Day of Week (name)', value: 'EE'},
                {label: 'h    Hour (1-12)', value: 'h'},
                {label: 'hh   Hour (2 digits 01-12)', value: 'hh'},
                {label: 'H    Hour (0-23)', value: 'H'},
                {label: 'HH   Hour (2 digits 00-23)', value: 'HH'},
                {label: 'K    Hour (0-11)', value: 'K'},
                {label: 'KK   Hour (2 digits 00-11)', value: 'KK'},
                {label: 'k    Hour (1-24)', value: 'k'},
                {label: 'kk   Hour (2 digits 01-24)', value: 'kk'},
                {label: 'm    Minute (0-59)', value: 'm'},
                {label: 'mm   Minute (2 digits 00-59)', value: 'mm'},
                {label: 's    Second (0-59)', value: 's'},
                {label: 'ss   Second (2 digits 00-59)', value: 'ss'},
                {label: 'l    Milliseconds (0-999)', value: 'l'},
                {label: 'll   Milliseconds (2 digits 00-99)', value: 'll'},
                {label: 'lll  Milliseconds (3 digits 000-999)', value: 'lll'},
                {label: 't    AM/PM (1 digit - Lowercase)', value: 't'},
                {label: 'tt   AM/PM (2 digits - Lowercase)', value: 'tt'},
                {label: 'T    AM/PM (1 digit - Uppercase)', value: 'T'},
                {label: 'TT   AM/PM (2 digits - Uppercase)', value: 'TT'},
                {label: 'Z    timezone (abbr.)', value: 'Z'},
                {label: 'o    timezone offset (abbr.)', value: 'o'},
                {label: 'S    date\'s ordinal suffix (st, nd, rd, or th)', value: 'S'},
                {label: 'x    Day difference', value: 'x'},
                {label: 'xx   Day difference (name)', value: 'xx'}];
            // #endregion definitions
            // #region functions
            $.fn.getCursorPosition = function () {
                const input = this.get(0);
                if (!input) {
                    return;
                } // No (input) element found

                if ('selectionStart' in input) {
                    // Standard-compliant browsers
                    return input.selectionStart;
                }
                if (document.selection) {
                    // IE
                    input.focus();
                    const sel = document.selection.createRange();
                    const selLen = document.selection.createRange().text.length;
                    sel.moveStart('character', -input.value.length);
                    return sel.text.length - selLen;
                }
            };

            function autocomplete(inputBox, dataList) {
            // don't navigate away from the field on tab when selecting an item
                inputBox.on('keydown', function (event) {
                    if (event.keyCode === $.ui.keyCode.TAB && $(this).autocomplete('instance') && $(this).autocomplete('instance').menu.active) {
                        event.preventDefault();
                    }
                }).autocomplete({
                    minLength: 0,
                    source(request, response) {
                        if (inputBox.getCursorPosition() < request.term.length) {
                            return;
                        }

                        // delegate back to autocomplete, but extract the last term
                        const term = request.term.split(/\W+/).pop();
                        const result = dataList.filter(x => x.value.startsWith(term));
                        response(result);
                    },
                    focus() {
                        // prevent value inserted on focus
                        return false;
                    },
                    select(event, ui) {
                        const terms = this.value.split(/\W+/);
                        // remove the current input
                        terms.pop();
                        // add the selected item
                        terms.push(ui.item.value);
                        // add placeholder to get the comma-and-space at the end
                        terms.push('');
                        this.value = terms.join(' ');
                        return false;
                    }
                });
            }

            function appendOptions(parent, elementName, limit) {
                const groups = SelectFields[elementName + 'Groups'];
                const elements = SelectFields[elementName];
                const groupLength = groups.length;
                const elementsLength = elements.length;
                for (let gIndex = 0; gIndex < groupLength; gIndex++) {
                    const group = $('<optgroup/>', {label: node._('time-span.' + elementName + 'Groups.' + gIndex)}).appendTo(parent);
                    for (let eIndex = 0; eIndex < elementsLength; eIndex++) {
                        if (groups[gIndex].id === elements[eIndex].group && (!limit || limit(elements[eIndex].id))) {
                            group.append($('<option></option>').val(elements[eIndex].id).text(node._('time-span.' + elementName + '.' + eIndex)).attr('addText', elements[eIndex].add));
                        }
                    }
                }
            }

            function setupTInput(data) {
                const tIField = $('#node-input-' + data.valueProp);
                $('#node-input-' + data.typeProp).val(node[data.typeProp]);
                tIField.typedInput({
                    default: node[data.valueProp] || data.defaultType,
                    typeField: $('#node-input-' + data.typeProp),
                    types: data.types
                });
                if (data.onChange) {
                    tIField.on('change', data.onChange);
                }
                if (data.width) {
                    tIField.typedInput('width', '200px');
                }
                return tIField;
            }
            // #endregion functions
            // #region operand1
            setupTInput({
                typeProp: 'operand1Type',
                valueProp: 'operand1',
                defaultType: typeMsgPayload.value,
                types: [typeMsgPayload, typeMsgTs, 'msg', 'flow', 'global', 'date', 'str', 'num', typeTimeSun, typeTimeMoon, typeDayOfMonth, 'env'],
                onChange: (_type, _value) => {
                    const opType = $('#node-input-operand1').typedInput('type');
                    if (opType === typeTimeEntered.value || opType === typeTimeSun.value || opType === typeTimeMoon.value || opType === 'date') {
                        $('.time-row-operand1Format').hide();
                        $('.time-row-operand1Offset').show();
                    } else if (opType === typeDateEntered.value ||
                                opType === 'msg' ||
                                opType === typeMsgPayload.value ||
                                opType === typeMsgTs.value ||
                                opType === 'flow' ||
                                opType === 'global' ||
                                opType === 'str' ||
                                opType === 'num' ||
                                opType === 'env') {
                        $('.time-row-operand1Format').show();
                        $('.time-row-operand1Offset').show();
                    } else {
                        $('.time-row-operand1Format').hide();
                        $('.time-row-operand1Offset').hide();
                    }
                },
                width:'calc(100% - 110px)'
            });

            const operand1FormatSelField = $('#node-input-operand1Formatsel');
            appendOptions(operand1FormatSelField, 'parseFormats');
            autocomplete($('#node-input-operand1Format'), dateParseFormat);
            operand1FormatSelField.on('change', (_type, _value) => {
                const operand1FormatIpField = $('#node-input-operand1Format');
                const operand1FormatSelField = $('#node-input-operand1Formatsel');
                if (Number(operand1FormatSelField.val()) === 99) {
                    operand1FormatSelField.css({width: '100px'});
                    operand1FormatIpField.css({width: 'calc(100% - 225px)'});
                    operand1FormatIpField.show();
                    if (!isNaN(operand1FormatIpField.val())) {
                        operand1FormatIpField.val(node._('time-span.timeFormat.default'));
                    }
                } else {
                    operand1FormatIpField.hide();
                    operand1FormatSelField.css({width: 'calc(100% - 120px)'});
                }
            });
            if (isNaN(node.operand1Format)) {
                operand1FormatSelField.val(99);
            } else {
                operand1FormatSelField.val(Number(node.operand1Format));
            }
            operand1FormatSelField.change();

            setupTInput({
                typeProp: 'operand1OffsetType',
                valueProp: 'operand1Offset',
                defaultType: typeUndefined.value,
                types: [typeUndefined, 'num', 'msg', 'flow', 'global', 'env'],
                onChange: (_type, _value) => {
                    const type = $('#node-input-operand1Offset').typedInput('type');
                    if (type === typeUndefined.value) {
                        $('.time-row-operand1OffsetMultiplier').hide();
                    } else {
                        $('.time-row-operand1OffsetMultiplier').show();
                    }
                }});

            const operand1MultiplierField = $('#node-input-operand1OffsetMultiplier');
            appendOptions(operand1MultiplierField, 'multiplier');
            operand1MultiplierField.val(node.operand1OffsetMultiplier);
            // #endregion operand1
            // #region operand2
            setupTInput({
                typeProp: 'operand2Type',
                valueProp: 'operand2',
                defaultType: typeMsgPayload.value,
                types: [typeMsgPayload, typeMsgTs, 'msg', 'flow', 'global', 'date', 'str', 'num', typeTimeSun, typeTimeMoon, typeDayOfMonth, 'env'],
                onChange: (_type, _value) => {
                    const opType = $('#node-input-operand2').typedInput('type');
                    if (opType === typeTimeEntered.value || opType === typeTimeSun.value || opType === typeTimeMoon.value || opType === 'date') {
                        $('.time-row-operand2Format').hide();
                        $('.time-row-operand2Offset').show();
                    } else if (opType === typeDateEntered.value ||
                                opType === 'msg' ||
                                opType === typeMsgPayload.value ||
                                opType === typeMsgTs.value ||
                                opType === 'flow' ||
                                opType === 'global' ||
                                opType === 'str' ||
                                opType === 'num' ||
                                opType === 'env') {
                        $('.time-row-operand2Format').show();
                        $('.time-row-operand2Offset').show();
                    } else {
                        $('.time-row-operand2Format').hide();
                        $('.time-row-operand2Offset').hide();
                    }
                },
                width:'calc(100% - 110px)'
            });

            const operand2FormatSelField = $('#node-input-operand2Formatsel');
            appendOptions(operand2FormatSelField, 'parseFormats');
            autocomplete($('#node-input-operand2Format'), dateParseFormat);
            operand2FormatSelField.on('change', (_type, _value) => {
                const operand2FormatIpField = $('#node-input-operand2Format');
                const operand2FormatSelField = $('#node-input-operand2Formatsel');
                if (Number(operand2FormatSelField.val()) === 99) {
                    operand2FormatSelField.css({width: '100px'});
                    operand2FormatIpField.css({width: 'calc(100% - 225px)'});
                    operand2FormatIpField.show();
                    if (!isNaN(operand2FormatIpField.val())) {
                        operand2FormatIpField.val(node._('time-span.timeFormat.default'));
                    }
                } else {
                    operand2FormatIpField.hide();
                    operand2FormatSelField.css({width: 'calc(100% - 120px)'});
                }
            });
            if (isNaN(node.operand2Format)) {
                operand2FormatSelField.val(99);
            } else {
                operand2FormatSelField.val(Number(node.operand2Format));
            }
            operand2FormatSelField.change();

            setupTInput({
                typeProp: 'operand2OffsetType',
                valueProp: 'operand2Offset',
                defaultType: typeUndefined.value,
                types: [typeUndefined, 'num', 'msg', 'flow', 'global', 'env'],
                onChange: (_type, _value) => {
                    const type = $('#node-input-operand2Offset').typedInput('type');
                    if (type === typeUndefined.value) {
                        $('.time-row-operand2OffsetMultiplier').hide();
                    } else {
                        $('.time-row-operand2OffsetMultiplier').show();
                    }
                }});
            const operand2MultiplierField = $('#node-input-operand2OffsetMultiplier');
            appendOptions(operand2MultiplierField, 'multiplier');
            operand2MultiplierField.val(node.operand2OffsetMultiplier);
            // #endregion operand2
            // #region rule-container
            function resizeRule(rule) {
                const newWidth = rule.width() - 10;
                // const operatorField = rule.find('.node-input-rule-operator');
                const operandField = rule.find('.node-input-rule-operand');
                const multipierField = rule.find('.node-input-rule-multipier');
                const lblWidth = 25;
                // row1
                const operatorWidth = 60;
                const multiplierWidth = 125;
                multipierField.width(multiplierWidth);
                operandField.typedInput('width', (newWidth - operatorWidth - multiplierWidth- lblWidth - 20));
            }

            $('#node-input-rule-container').css('min-height', '150px').css('min-width', '200px').editableList({
                addItem(containerRow, containerIndex, data) {
                    containerRow.css({overflow: 'hidden', whiteSpace: 'nowrap'});
                    const row = $('<div/>').appendTo(containerRow);
                    // row1
                    // operator
                    const operatorField = $('<select/>', {
                        class: 'node-input-rule-operator',
                        id: 'node-input-rule-operator' + containerIndex
                    }).appendTo(row);
                    appendOptions(operatorField, 'operators');

                    const operandField = $('<input/>', {
                        class: 'node-input-rule-operand',
                        id: 'node-input-rule-operand' + containerIndex,
                        type: 'text'
                    }).appendTo(row).typedInput({
                        default: 'num',
                        types: ['msg', 'flow', 'global', 'num', 'env', 'jsonata']
                    });
                    const multiplierField = $('<select/>', {
                        class: 'node-input-rule-multiplier',
                        id: 'node-input-rule-multiplier' + containerIndex
                    }).appendTo(row);
                    appendOptions(multiplierField, 'multiplier', (id) => (id > 0) );
                    const finalspan = $('<span/>', {
                        style: 'float: right; margin-top: 6px;'
                    }).appendTo(row);
                    finalspan.append(' &#8594; <span class="node-input-rule-index">' + (containerIndex + 1) + '</span> ');
                    // setting defaultValues
                    // console.log(data);
                    operatorField.val(data.operator || SelectFields.operators[0].id);
                    operandField.typedInput('type', data.operandType || 'num');
                    operandField.typedInput('value', data.operandValue || '');
                    multiplierField.val(data.multiplier || SelectFields.multiplier[0].id);
                    resizeRule(containerRow);
                },
                sortItems(rules) {
                    rules = $('#node-input-rule-container').editableList('items');
                    rules.each(function (i) {
                        $(this).find('.node-input-rule-index').html(i + 1);
                    });
                },
                resizeItem: resizeRule,
                sortable: true,
                removable: true
            });
            if (node.rules) {
                for (let i = 0; i < node.rules.length; i++) {
                    const rule = node.rules[i];
                    $('#node-input-rule-container').editableList('addItem', rule);
                }
            }
            // #endregion rule-container
            // #region result1
            setupTInput({
                typeProp: 'result1Type',
                valueProp: 'result1',
                defaultType: typeUndefined.value,
                types: [typeUndefined, typeMsgPayload, typeMsgTs, 'msg', 'flow', 'global'],
                width:'calc(100% - 110px)',
                onChange: (_type, _value) => {
                    console.log('node-input-result1 change ' + $('#node-input-result1').typedInput('type')); // eslint-disable-line
                    if ($('#node-input-result1').typedInput('type') !== typeUndefined.value) {
                        $('.time-result1Value').show();
                        const plVType = $('#node-input-result1Value').typedInput('type');
                        console.log('plVType= ' + plVType); // eslint-disable-line

                        if (plVType === typeTimeEntered.value || plVType === typeTimeSun.value || plVType === typeTimeMoon.value || plVType === 'date') {
                            $('.time-row-result1Offset').show();
                            $('.time-row-result1TSFormat').hide();
                            $('.time-row-result1Format').show();
                        } else if (plVType === 'timespan') {
                            $('.time-row-result1Offset').hide();
                            $('.time-row-result1Format').hide();
                            $('.time-row-result1TSFormat').show();
                        } else if (plVType === 'operand1' || plVType === 'operand2') {
                            $('.time-row-result1Offset').hide();
                            $('.time-row-result1TSFormat').hide();
                            $('.time-row-result1Format').show();
                        } else {
                            $('.time-row-result1Offset').hide();
                            $('.time-row-result1TSFormat').hide();
                            $('.time-row-result1Format').hide();
                        }
                    } else {
                        $('.time-result1Value').hide();
                        $('.time-row-result1Offset').hide();
                        $('.time-row-result1TSFormat').hide();
                        $('.time-row-result1Format').hide();
                    }
                    $('#time-row-result1FormatSel').change(); // show '.time-row-result1Format'
                    $('#time-row-result1TSFormatSel').change(); // show '.time-row-result1Format'
                } });

            setupTInput({
                typeProp: 'result1ValueType',
                valueProp: 'result1Value',
                defaultType: 'timespan',
                width: 'calc(100% - 120px)',
                types: [
                    {value: 'timespan', label: 'timespan between Inputs', hasValue: false},
                    {value: 'operand1', label: 'Input 1 value', hasValue: false},
                    {value: 'operand2', label: 'Input 2 value', hasValue: false},
                    'date',
                    typeTimeEntered,
                    typeTimeSun,
                    typeTimeMoon,
                    'flow',
                    'global',
                    'str',
                    'num',
                    'bool',
                    'json',
                    'bin',
                    'env',
                    'jsonata',
                    typeSunCalc,
                    typeMoonCalc
                ],
                onChange: (_type, _value) => { $('#node-input-result1').change(); }});
            /********************************************************/
            const resultTSFormatSelField = $('#node-input-result1TSFormatSel');
            appendOptions(resultTSFormatSelField, 'outputTSFormats');
            resultTSFormatSelField.on('change', (_type, _value) => {
                const resultTSFormatIpField = $('#node-input-result1TSFormat');
                const resultTSFormatSelField = $('#node-input-result1TSFormatSel');

                console.log('node-input-resultTSFormatSelField change ' + resultTSFormatSelField.val() + ' - ' + resultTSFormatIpField.val()); // eslint-disable-line

                if (Number(resultTSFormatSelField.val()) === 99) {
                    resultTSFormatSelField.css({width: '100px'});
                    resultTSFormatIpField.css({width: 'calc(100% - 235px)'});
                    resultTSFormatIpField.show();
                    if (!isNaN(resultTSFormatIpField.val())) {
                        resultTSFormatIpField.val(node._('time-span.timeFormat.default'));
                    }
                } else {
                    resultTSFormatIpField.hide();
                    resultTSFormatSelField.css({width: 'calc(100% - 130px)'});
                }
            });
            resultTSFormatSelField.change();
            /********************************************************/
            const resultFormatSelField = $('#node-input-result1FormatSel');
            appendOptions(resultFormatSelField, 'outputFormats');
            resultFormatSelField.on('change', (_type, _value) => {
                const resultFormatIpField = $('#node-input-result1Format');
                const resultFormatSelField = $('#node-input-result1FormatSel');
                if (Number(resultFormatSelField.val()) === 99) {
                    resultFormatSelField.css({width: '100px'});
                    resultFormatIpField.css({width: 'calc(100% - 235px)'});
                    resultFormatIpField.show();
                    if (!isNaN(resultFormatIpField.val())) {
                        resultFormatIpField.val(node._('time-span.timeFormat.default'));
                    }
                } else {
                    resultFormatIpField.hide();
                    resultFormatSelField.css({width: 'calc(100% - 130px)'});
                }
            });
            /********************************************************/
            if (isNaN(node.result1Format)) {
                resultFormatSelField.val(99);
            } else {
                resultFormatSelField.val(Number(node.result1Format));
            }
            resultFormatSelField.change();
            setupTInput({
                typeProp: 'result1OffsetType',
                valueProp: 'result1Offset',
                defaultType: typeUndefined.value,
                types: [typeUndefined, 'num', 'msg', 'flow', 'global', 'env'],
                onChange: (_type, _value) => {
                    const type = $('#node-input-result1Offset').typedInput('type');
                    if (type === typeUndefined.value) {
                        $('.time-row-result1OffsetMultiplier').hide();
                    } else {
                        $('.time-row-result1OffsetMultiplier').show();
                    }
                }});
            const resultMultiplierField = $('#node-input-result1OffsetMultiplier');
            appendOptions(resultMultiplierField, 'multiplier');
            resultMultiplierField.val(node.result1OffsetMultiplier);
            autocomplete($('#node-input-result1TSFormat'), dateOutTSFormat);
            autocomplete($('#node-input-result1Format'), dateOutFormat);
            // #endregion result1
            // #region spinner
            $('.wg-offset-spinner').spinner({max: 1439,min: -1439});
            // #endregion spinner

            $('#node-input-time').change();
            $('#node-input-payload').change();
            $('#node-input-operand1').change();
            $('#node-input-operand2').change();
            $('#node-input-result1').change();
        },
        oneditsave() {
            const node = this;
            if (Number($('#node-input-operand1Formatsel').val()) !== 99) {
                $('#node-input-operand1Format').val($('#node-input-operand1Formatsel').val());
                node.operand1Format = $('#node-input-operand1Formatsel').val();
            }
            if (Number($('#node-input-operand2Formatsel').val()) !== 99) {
                $('#node-input-operand2Format').val($('#node-input-operand2Formatsel').val());
                node.operand2Format = $('#node-input-operand2Formatsel').val();
            }
            // #region rule-container
            node.rules = [];
            const rules = $('#node-input-rule-container').editableList('items');
            rules.each(function (_i) {
                const rule = $(this);
                const data = {
                    operator: rule.find('.node-input-rule-operator').val(),
                    operatorText: rule.find('.node-input-rule-operator option:selected').text(),
                    operandType: rule.find('.node-input-rule-operand').typedInput('type'),
                    operandValue: rule.find('.node-input-rule-operand').typedInput('value'),
                    multiplier: rule.find('.node-input-rule-multipier').val()
                };
                node.rules.push(data);
            });
            // console.log(this.rules);
            const outputs = (node.rules) ? (node.rules.length + 1) : 1;
            $('#node-input-outputs').val(outputs);
            // #endregion result-container
            // console.log(outputs);

            if (Number($('#node-input-result1FormatSel').val()) !== 99) {
                $('#node-input-result1Format').val($('#node-input-result1FormatSel').val());
                node.result1Format = $('#node-input-result1FormatSel').val();
            }

            node.operand1Type = $('#node-input-operand1').typedInput('type');
            node.operand2Type = $('#node-input-operand2').typedInput('type');
            node.result1Type = $('#node-input-result1').typedInput('type');
            node.result1ValueType = $('#node-input-result1Value').typedInput('type');
            node.result2Type = $('#node-input-result2').typedInput('type');
            node.result2ValueType = $('#node-input-result2Value').typedInput('type');
        // console.log($("#node-input-outputs").val());
        },
        oneditresize(size) {
            const rows = $('#dialog-form>div:not(.node-input-rule-container-row)');
            let height = size.height;
            for (let i = 0; i < rows.size(); i++) {
                height -= $(rows[i]).outerHeight(true);
            }

            const editorRow = $('#dialog-form>div.node-input-rule-container-row');
            height -= (parseInt(editorRow.css('marginTop')) + parseInt(editorRow.css('marginBottom')));
            $('#node-input-rule-container').editableList('height', height);
        }
    });</script>
